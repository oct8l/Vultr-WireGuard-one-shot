name: Terraform Validation

on:
  pull_request:
    paths:
      - 'terraform/**'
      - '.github/workflows/terraform-validation.yml'
  push:
    branches:
      - main
    paths:
      - 'terraform/**'
      - '.github/workflows/terraform-validation.yml'

jobs:
  validate-terraform:
    name: Validate Terraform Files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@b9cd54a3c349d3f38e8881555d616ced269862dd # v3
        with:
          terraform_version: "1.13.3"

      - name: Terraform Format Check
        id: fmt
        run: |
          cd terraform
          terraform fmt -check -recursive
        continue-on-error: true

      - name: Terraform Init
        id: init
        run: |
          cd terraform
          terraform init -backend=false

      - name: Terraform Validate
        id: validate
        run: |
          cd terraform
          terraform validate -no-color

      - name: Validation summary
        if: success()
        run: |
          echo ""
          echo "╔════════════════════════════════════════════════════════════╗"
          echo "║         ✅ All Terraform validations passed!              ║"
          echo "╚════════════════════════════════════════════════════════════╝"
          echo ""
          echo "The following checks passed:"
          echo "  ✅ Terraform formatting check"
          echo "  ✅ Terraform initialization"
          echo "  ✅ Terraform validation"
          echo ""
